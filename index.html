<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>世界.执行(我);</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap');

        :root {
            --main-bg: #0a0a0a;
            --text-color: #00ff41;
            --highlight-color: #f0f0f0;
            --error-color: #ff3333;
            --love-color: #ff69b4;
            --bsod-bg: #0000aa;
            --bsod-text: #ffffff;
            --font-main: 'Share Tech Mono', monospace;
            --font-display: 'VT323', monospace;
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--main-bg);
            color: var(--text-color);
            font-family: var(--font-main);
            overflow: hidden;
            text-shadow: 0 0 5px var(--text-color), 0 0 10px var(--text-color);
        }

        #container {
            position: relative;
            width: 100%; height: 100%;
            padding: 2vw;
        }
        
        /* CRT Effects */
        #container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0;
            bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 3px, 4px 100%;
            pointer-events: none;
            animation: scanline 8s linear infinite;
        }
        #container::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0;
            bottom: 0; right: 0;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0) 60%, rgba(0,0,0,0.8) 100%);
            z-index: 2;
            pointer-events: none;
        }
        @keyframes scanline {
            from { background-position: 0 0; }
            to { background-position: 0 100%; }
        }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--main-bg);
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; cursor: pointer;
            z-index: 100;
            font-size: 2.5em; font-family: var(--font-display);
            transition: opacity 1s;
        }
        #overlay.hidden { opacity: 0; pointer-events: none; }
        #overlay-cursor { animation: blink 1s step-end infinite; }

        #visuals {
            position: relative; z-index: 10;
            width: 100%; height: 100%;
            font-size: 1.1rem;
            overflow: hidden;
        }

        .line {
            display: block; margin-bottom: 0.5em;
            white-space: pre-wrap;
        }
        .line > .prompt { opacity: 0.6; }
        .cursor {
            display: inline-block; background-color: var(--text-color);
            width: 0.6em; height: 1.2em; vertical-align: middle;
            animation: blink 1s step-end infinite;
        }

        .emphasis {
            font-family: var(--font-display);
            font-size: 2.5em; color: var(--highlight-color);
            text-shadow: 0 0 8px var(--highlight-color);
            display: block; text-align: center;
            letter-spacing: 5px; animation: fadeIn 0.5s;
        }
        .error {
            color: var(--error-color); text-shadow: 0 0 8px var(--error-color);
        }
        .love {
            color: var(--love-color); text-shadow: 0 0 8px var(--love-color);
            animation: pulse 1.5s infinite;
        }

        /* Animations */
        @keyframes blink { from, to { background-color: transparent; } 50% { background-color: var(--text-color); } }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes screenShake { 0%{transform:translate(2px,1px) rotate(0deg)}10%{transform:translate(-1px,-2px) rotate(-.8deg)}20%{transform:translate(-3px,0) rotate(.8deg)}30%{transform:translate(3px,2px) rotate(0deg)}40%{transform:translate(1px,-1px) rotate(.8deg)}50%{transform:translate(-1px,2px) rotate(-.8deg)}60%{transform:translate(-3px,1px) rotate(0deg)}70%{transform:translate(3px,1px) rotate(-.8deg)}80%{transform:translate(-1px,-1px) rotate(.8deg)}90%{transform:translate(2px,2px) rotate(0deg)}100%{transform:translate(1px,-2px) rotate(-.8deg)} }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.8; } }
        
        .dizzy { animation: blurEffect 2s linear infinite; }
        @keyframes blurEffect { 
            0% { filter: blur(0); } 
            50% { filter: blur(5px); } 
            100% { filter: blur(0); } 
        }

        .ac-mode { --text-color: #ff4444; }
        .dc-mode { --text-color: #4444ff; }
        .blind { filter: blur(5px) brightness(0.3); }
        .time-travel { animation: timeWarp 3s ease-in-out; }
        @keyframes timeWarp { 0% { filter: hue-rotate(0deg); } 50% { filter: hue-rotate(180deg) sepia(1); } 100% { filter: hue-rotate(360deg); } }

        /* Special Effects Elements */
        #binary-canvas, #bsod-screen {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 5;
            pointer-events: none;
        }
        .code-snippet, .progress-bar-container {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--text-color);
            padding: 1em; margin: 1em 0;
            white-space: pre; font-family: var(--font-main);
        }
        .progress-bar { height: 1.2em; background-color: var(--text-color); width: 0; transition: width 1s linear; }
        .token.keyword { color: #cc7832; }
        .token.class-name { color: #a9b7c6; }
        .token.function { color: #ffc66d; }
        .token.string { color: #6a8759; }

        #bsod-screen {
            background-color: var(--bsod-bg);
            color: var(--bsod-text);
            font-family: 'Lucida Console', monospace;
            text-shadow: none;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 50;
        }
        .bsod-text { font-size: 1.2em; text-align: center; }
        .bsod-dump { font-size: 0.8em; margin-top: 2em; }

        .shape { position: absolute; }
        .point, .sine-dot { width: 5px; height: 5px; background-color: var(--highlight-color); border-radius: 50%; box-shadow: 0 0 10px var(--highlight-color); }
        .circle { border: 2px solid var(--highlight-color); border-radius: 50%; box-shadow: 0 0 15px var(--highlight-color); animation: fadeIn 1s; }
        .tangent-line { border-top: 1px dashed var(--love-color); transform-origin: left center; }
        .limit-line { border-top: 2px solid var(--error-color); }

        .chaos-text {
            position: absolute; font-family: var(--font-display);
            opacity: 0.8; animation: fadeIn 0.2s;
        }

        /* New effect styles */
        .emoji-display {
            position: absolute;
            font-size: 3em;
            animation: bounceIn 0.8s ease-out;
            z-index: 15;
        }
        @keyframes bounceIn {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        .gender-symbol {
            position: absolute;
            font-size: 4em;
            animation: genderSwitch 1s ease-in-out;
            z-index: 15;
        }
        @keyframes genderSwitch {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg) scale(1.2); }
            100% { transform: rotateY(180deg); }
        }

        .time-display {
            position: absolute;
            font-family: 'Courier New', monospace;
            font-size: 2em;
            background: rgba(0,0,0,0.8);
            padding: 0.5em;
            border: 2px solid var(--text-color);
            animation: digitalClock 2s ease-in-out;
        }
        @keyframes digitalClock {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0.9; transform: scale(1); }
        }

        .molecule {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            animation: moleculeFloat 3s ease-in-out infinite;
        }
        @keyframes moleculeFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .sound-wave {
            position: absolute;
            height: 4px;
            background: linear-gradient(to right, var(--love-color), transparent);
            animation: soundWave 1s ease-in-out infinite;
        }
        @keyframes soundWave {
            0% { width: 0; opacity: 1; }
            100% { width: 200px; opacity: 0; }
        }

        .year-display {
            position: absolute;
            font-family: var(--font-display);
            font-size: 3em;
            color: gold;
            text-shadow: 0 0 10px gold;
            animation: timeTravel 0.5s ease-in-out;
        }
        @keyframes timeTravel {
            0% { opacity: 0; transform: scale(2) rotateX(90deg); }
            100% { opacity: 1; transform: scale(1) rotateX(0deg); }
        }

        .unite-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            border: 3px solid var(--love-color);
            border-radius: 50%;
            animation: unite 2s ease-in-out;
        }
        @keyframes unite {
            0% { transform: scale(0.1); opacity: 0; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(3); opacity: 0; }
        }

        .trance-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 30%, rgba(255, 105, 180, 0.3) 100%);
            animation: trance 4s ease-in-out;
            z-index: 8;
        }
        @keyframes trance {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.7; }
        }
        
        .power-line {
            position: absolute;
            height: 2px;
            background: var(--text-color);
            box-shadow: 0 0 10px var(--text-color);
            animation: powerPulse 0.5s infinite alternate;
            z-index: 5;
        }
        @keyframes powerPulse {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        .protection-shield {
            position: absolute;
            border: 3px solid var(--text-color);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--text-color);
            animation: shieldPulse 2s infinite;
            z-index: 10;
        }
        @keyframes shieldPulse {
            0% { transform: scale(0.5); opacity: 0.5; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.5); opacity: 0.5; }
        }
        
        .object-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--text-color);
            border-radius: 50%;
            animation: particleFloat 3s ease-in-out;
            z-index: 7;
        }
        @keyframes particleFloat {
            0% { transform: translateY(0) scale(0.2); opacity: 1; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="overlay">
        <span>世界.执行(我);</span>
        <span>点击运行<span id="overlay-cursor">_</span></span>
    </div>

    <audio id="song" preload="auto">
        <source src="https://world.execute.umstudio.top/world-execute-me-compressed.mp3" type="audio/mpeg">
        您的浏览器不支持 audio 标签。
    </audio>

    <div id="container">
        <div id="visuals"></div>
    </div>

    <script>
        const song = document.getElementById('song');
        const overlay = document.getElementById('overlay');
        const visuals = document.getElementById('visuals');
        const container = document.getElementById('container');

        const timeline = [
            { time: 0.100, func: typeLine, args: { text: "启动电源线路", speed: 240, onComplete: showPowerLines } },
            { time: 1.740, func: typeLine, args: { text: "别忘了穿上", speed: 285 } },
            { time: 2.920, func: showEmphasis, args: { text: "保护", onComplete: showProtectionShield } },
            { time: 3.873, func: typeLine, args: { text: "布下你的棋子", speed: 200 } },
            { time: 5.491, func: typeLine, args: { text: "然后我们开始", speed: 160 } },
            { time: 6.380, func: showCodeSnippet },
            { time: 7.446, func: typeLine, args: { text: "填入我的数据参数", speed: 203 } },
            { time: 10.091, func: showProgressBar },
            { time: 11.095, func: typeLine, args: { text: "建立我们的新世界", speed: 133 } },
            { time: 12.906, func: typeLine, args: { text: "让我们开始这场", speed: 171 } },
            { time: 13.891, func: showEmphasis, args: { text: "模拟" } },
            
            { time: 16.000, func: startBinaryRain },
            { time: 29.000, func: stopBinaryRain },
            { time: 29.500, func: clearScreen },

            { time: 29.709, func: typeLine, args: { text: "如果我是一组点", speed: 197, onComplete: drawPoints } },
            { time: 31.116, func: typeLine, args: { text: "那我将给你我的", speed: 214 } },
            { time: 32.682, func: showEmphasis, args: { text: "维度" } },
            { time: 33.412, func: typeLine, args: { text: "如果我是一个圆", speed: 137, onComplete: drawCircle } },
            { time: 34.646, func: typeLine, args: { text: "那我将给你我的", speed: 214 } },
            { time: 36.287, func: showEmphasis, args: { text: "周长" } },
            { time: 37.067, func: typeLine, args: { text: "如果我是正弦波", speed: 154, onComplete: drawSineWave } },
            { time: 38.596, func: typeLine, args: { text: "你便能坐在我所有的", speed: 187 } },
            { time: 40.049, func: showEmphasis, args: { text: "切线", onComplete: drawTangents } },
            { time: 40.706, func: typeLine, args: { text: "如果我趋近于无限", speed: 173 } },
            { time: 42.346, func: typeLine, args: { text: "你便能成为我的", speed: 163, onComplete: drawLimitations } },
            { time: 43.507, func: showEmphasis, args: { text: "极限" } },
            
            { time: 44.452, func: typeLine, args: { text: "切换我的电流", speed: 170 } },
            { time: 45.850, func: typeLine, args: { text: "从交流到直流", speed: 120, onComplete: currentSwitch } },
            { time: 47.672, func: typeLine, args: { text: "然后蒙蔽我的视觉", speed: 188 } },
            { time: 49.534, func: blindVision },
            { time: 50.000, func: typeLine, args: { text: "如此晕眩，如此晕眩", speed: 127 } },
            
            { time: 51.363, func: typeLine, args: { text: "哦 我们可以穿行", speed: 137 } },
            { time: 53.225, func: typeLine, args: { text: "从公元后到公元前", speed: 105, onComplete: timeTravel } },
            { time: 55.083, func: typeLine, args: { text: "而我们能够结合", speed: 137 } },
            { time: 56.916, func: typeLine, args: { text: "如此深刻，如此深刻", speed: 140, onComplete: uniteEffect } },
            
            { time: 58.000, func: clearScreen },
            
            { time: 59.223, func: typeLine, args: { text: "如果我能 如果我能给你所有的", speed: 154 } },
            { time: 61.958, func: showEmphasis, args: { text: "刺激" } },
            { time: 62.589, func: typeLine, args: { text: "那我就能 那我就能成为你唯一的", speed: 144 } },
            { time: 65.397, func: showEmphasis, args: { text: "满足" } },
            { time: 66.601, func: typeLine, args: { text: "如果我能让你开心", speed: 180 } },
            { time: 68.252, func: typeLine, args: { text: "我就将运行这场", speed: 120 } },
            { time: 69.259, func: showEmphasis, args: { text: "执行" } },
            { time: 70.084, func: typeLine, args: { text: "尽管我们被困于", speed: 180 } },
            { time: 71.764, func: typeLine, args: { text: "在这场怪异至极的", speed: 173 } },
            { time: 73.169, func: showEmphasis, args: { text: "模拟" } },
            
            { time: 74.045, func: clearScreenAndShapes },
            { time: 74.045, func: typeLine, args: { text: "如果我是一根茄子", speed: 135, onComplete: () => showEmoji('🍆') } },
            { time: 75.422, func: typeLine, args: { text: "那我将给你我的", speed: 214 } },
            { time: 76.959, func: showEmphasis, args: { text: "养分", onComplete: showNutrients } },
            { time: 77.576, func: typeLine, args: { text: "如果我是一颗番茄", speed: 113, onComplete: () => showEmoji('🍅') } },
            { time: 79.226, func: typeLine, args: { text: "那我将给你", speed: 240 } },
            { time: 80.620, func: showEmphasis, args: { text: "抗氧化剂", onComplete: showMolecules } },
            { time: 81.351, func: typeLine, args: { text: "如果我是一只虎斑猫", speed: 120, onComplete: () => showEmoji('🐱') } },
            { time: 82.833, func: typeLine, args: { text: "我会为你咕噜作响", speed: 195 } },
            { time: 84.268, func: showEmphasis, args: { text: "愉悦", onComplete: showSoundWaves } },
            { time: 85.078, func: typeLine, args: { text: "如果我是唯一的神", speed: 143, onComplete: () => showEmoji('⚡') } },
            { time: 86.538, func: typeLine, args: { text: "那你就是我存在的", speed: 210 } },
            { time: 87.922, func: showEmphasis, args: { text: "证明" } },
            
            { time: 88.587, func: typeLine, args: { text: "切换我的性别", speed: 160 } },
            { time: 90.197, func: typeLine, args: { text: "从女到男", speed: 150, onComplete: genderSwitch } },
            { time: 92.015, func: typeLine, args: { text: "然后随心所欲", speed: 200 } },
            { time: 93.953, func: typeLine, args: { text: "无论白昼黑夜", speed: 120, onComplete: showTimeDisplay } },
            { time: 95.465, func: typeLine, args: { text: "哦 切换我的角色", speed: 137 } },
            { time: 97.739, func: typeLine, args: { text: "从S到M", speed: 150, onComplete: roleSwitch } },
            { time: 99.349, func: typeLine, args: { text: "这样我们就能进入", speed: 113 } },
            { time: 101.474, func: typeLine, args: { text: "这场迷幻，这场迷幻", speed: 147, onComplete: enterTrance } },
            
            { time: 102.500, func: clearScreen },

            { time: 103.489, func: typeLine, args: { text: "如果我能 如果我能感受你的", speed: 138 } },
            { time: 106.293, func: showEmphasis, args: { text: "振动", onComplete: rippleEffect } },
            { time: 107.220, func: typeLine, args: { text: "那我就能 那我就能最终变得", speed: 157 } },
            { time: 110.221, func: showEmphasis, args: { text: "完整" } },
            
            { time: 110.900, func: clearScreen },
            { time: 110.900, func: typeLine, args: { text: "尽管你已经离开...", speed: 173 } },
            { time: 112.220, func: typeLine, args: { text: "你已经离开...", speed: 150 } },
            { time: 113.100, func: typeLine, args: { text: "你已经离开...", speed: 150 } },
            { time: 114.180, func: typeLine, args: { text: "你已经离开...", speed: 150 } },
            { time: 114.920, func: typeLine, args: { text: "你已经离开...", speed: 150 } },
            { time: 115.780, func: typeLine, args: { text: "你将我遗弃在", speed: 190 } },
            { time: 117.274, func: showIsolation },
            
            { time: 118.333, func: clearScreen },
            { time: 118.333, func: typeLine, args: { text: "如果我能 如果我能清除所有无意义的", speed: 148 } },
            { time: 120.860, func: showEmphasis, args: { text: "碎片" } },
            { time: 121.728, func: typeLine, args: { text: "那么也许 那么也许你就不会让我如此", speed: 166 } },
            { time: 124.890, func: showEmphasis, args: { text: "心碎" } },
            
            { time: 125.708, func: clearScreen },
            { time: 125.708, func: addClass, args: { target: container, className: 'error screenShake', duration: 12000 } },
            { time: 125.708, func: typeLine, args: { text: "挑战你的神明...", speed: 206 } },
            { time: 128.661, func: typeLine, args: { text: "你制造了一些", speed: 180 } },
            { time: 131.224, func: showEmphasis, args: { text: "非法参数" } },

            { time: 133.500, func: showBSOD },
            { time: 147.000, func: hideBSOD },
            
            { time: 147.660, func: clearScreen },
            { time: 147.660, func: executionSpamExtended, args: { duration: 10340 } },
            
            { time: 158.900, func: showChaosText, args: { text: "一" } },
            { time: 159.321, func: showChaosText, args: { text: "二" } },
            { time: 159.657, func: showChaosText, args: { text: "三" } },
            { time: 160.244, func: showChaosText, args: { text: "四" } },
            { time: 160.693, func: showChaosText, args: { text: "五" } },
            { time: 161.124, func: showChaosText, args: { text: "六" } },
            { time: 161.584, func: showEmphasis, args: { text: "执行" } },
            
            { time: 162.632, func: clearScreen },
            { time: 162.632, func: typeLine, args: { text: "如果我能 如果我能给予他们所有的", speed: 144 } },
            { time: 165.166, func: showEmphasis, args: { text: "执行", className: 'error' } },
            { time: 166.016, func: typeLine, args: { text: "那我就能 那我就能成为你唯一的", speed: 144 } },
            { time: 168.911, func: showEmphasis, args: { text: "执行", className: 'error' } },
            { time: 169.824, func: typeLine, args: { text: "如果我能让你回来", speed: 165 } },
            { time: 171.868, func: typeLine, args: { text: "我就将运行这场", speed: 120 } },
            { time: 172.712, func: showEmphasis, args: { text: "执行", className: 'error' } },
            { time: 173.643, func: typeLine, args: { text: "尽管我们被困... 我们被困啊—", speed: 184 } },

            { time: 177.246, func: clearScreen },
            { time: 177.246, func: typeLine, args: { text: "我研究过 我研究过如何正确地", speed: 189 } },
            { time: 179.929, func: showEmphasis, args: { text: "L O-O-O V E", className: 'love' } },
            { time: 180.857, func: typeLine, args: { text: "拷问我吧 拷问我吧 我能回答所有", speed: 161 } },
            { time: 183.646, func: showEmphasis, args: { text: "L O-O-O V E", className: 'love' } },
            { time: 184.540, func: typeLine, args: { text: "我知晓关于“爱”的代数表达", speed: 255 } },
            { time: 187.665, func: showEmphasis, args: { text: "L O-O-O V E", className: 'love' } },
            
            { time: 188.483, func: clearScreen },
            { time: 188.483, func: typeLine, args: { text: "尽管你是自由的...", speed: 173, style: {opacity: 0.7} } },
            { time: 189.746, func: typeLine, args: { text: "我却被困住了。", speed: 130, style: {fontSize: '1.5em'} } },
            { time: 190.801, func: typeLine, args: { text: "困于...", speed: 240 } },
            { time: 191.356, func: showTrappedInLove },
            
            { time: 205.811, func: clearScreen },
            { time: 205.811, func: finalExecution },
        ];
        
        let currentIndex = 0;
        let animationFrameId;

        function startExperience() {
            overlay.classList.add('hidden');
            song.play().then(() => {
                animationFrameId = requestAnimationFrame(update);
            }).catch(e => {
                console.error("音频播放失败:", e);
                overlay.innerHTML = `<span>错误：无法播放音频。</span><span>音频文件是否在同一文件夹中？</span>`;
                overlay.classList.remove('hidden');
            });
        }

        function update() {
            const currentTime = song.currentTime;
            while (currentIndex < timeline.length && currentTime >= timeline[currentIndex].time) {
                const event = timeline[currentIndex];
                event.func(event.args || {});
                currentIndex++;
            }
            if (!song.ended) {
                animationFrameId = requestAnimationFrame(update);
            } else {
                cancelAnimationFrame(animationFrameId);
            }
        }
        overlay.addEventListener('click', startExperience, { once: true });
        
        // MODIFIED function to accept custom typing speed
        function typeLine({ text, className = '', style = {}, onComplete = null, speed = 60 }) {
            const line = document.createElement('div');
            line.className = `line ${className}`;
            Object.assign(line.style, style);
            line.innerHTML = `<span class="prompt">C:\\> </span><span class="text"></span><span class="cursor"></span>`;
            visuals.appendChild(line);
            
            const textSpan = line.querySelector('.text');
            const cursor = line.querySelector('.cursor');
            let i = 0;
            const typingInterval = setInterval(() => {
                if (i < text.length) {
                    textSpan.textContent += text.charAt(i);
                    i++;
                    visuals.scrollTop = visuals.scrollHeight;
                } else {
                    clearInterval(typingInterval);
                    cursor.remove();
                    if (onComplete) onComplete();
                }
            }, speed); // Use the speed parameter here
        }

        function showEmphasis({ text, className = '', onComplete = null }) {
            const el = document.createElement('div');
            el.className = `emphasis ${className}`;
            el.textContent = text;
            visuals.appendChild(el);
            visuals.scrollTop = visuals.scrollHeight;
            if (onComplete) onComplete();
        }

        function clearScreen() { visuals.innerHTML = ''; }
        function clearShapes() { document.querySelectorAll('.shape, .emoji-display, .gender-symbol, .time-display, .molecule, .sound-wave, .year-display, .unite-effect, .trance-overlay, .power-line, .protection-shield, .object-particle').forEach(el => el.remove()); }
        function clearScreenAndShapes() { clearScreen(); clearShapes(); }

        function addClass({ target, className, duration }) {
            target.classList.add(...className.split(' '));
            setTimeout(() => {
                target.classList.remove(...className.split(' '));
            }, duration);
        }

        function showPowerLines() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.className = 'power-line';
                    line.style.top = `${Math.random() * 100}%`;
                    line.style.left = '0';
                    line.style.width = '100%';
                    container.appendChild(line);
                    setTimeout(() => line.remove(), 1000);
                }, i * 200);
            }
        }
        
        function showProtectionShield() {
            const shield = document.createElement('div');
            shield.className = 'protection-shield';
            shield.style.left = '50%';
            shield.style.top = '50%';
            shield.style.transform = 'translate(-50%, -50%)';
            shield.style.width = '300px';
            shield.style.height = '300px';
            container.appendChild(shield);
            setTimeout(() => shield.remove(), 2000);
        }
        
        function currentSwitch() {
            addClass({ target: container, className: 'ac-mode', duration: 500 });
            setTimeout(() => {
                addClass({ target: container, className: 'dc-mode', duration: 500 });
            }, 500);
        }

        function blindVision() {
            addClass({ target: container, className: 'blind dizzy', duration: 3000 });
        }

        function timeTravel() {
            addClass({ target: container, className: 'time-travel', duration: 3000 });
            
            const years = ['公元2024年', '公元1000年', '公元前500年', '公元前1000年'];
            years.forEach((year, i) => {
                setTimeout(() => {
                    const yearEl = document.createElement('div');
                    yearEl.className = 'year-display';
                    yearEl.textContent = year;
                    yearEl.style.left = `${20 + i * 20}%`;
                    yearEl.style.top = `${30 + i * 10}%`;
                    container.appendChild(yearEl);
                    setTimeout(() => yearEl.remove(), 1000);
                }, i * 300);
            });
        }

        function uniteEffect() {
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const unite = document.createElement('div');
                    unite.className = 'unite-effect';
                    unite.style.left = `${30 + i * 20}%`;
                    unite.style.top = `${40 + i * 10}%`;
                    container.appendChild(unite);
                    setTimeout(() => unite.remove(), 2000);
                }, i * 500);
            }
        }

        function showEmoji(emoji) {
            const el = document.createElement('div');
            el.className = 'emoji-display';
            el.textContent = emoji;
            el.style.left = `${Math.random() * 70 + 15}%`;
            el.style.top = `${Math.random() * 60 + 20}%`;
            container.appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }

        function showNutrients() {
            const nutrients = ['维生素C', '纤维', '钾', '叶酸'];
            nutrients.forEach((nutrient, i) => {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.className = 'emoji-display';
                    el.style.fontSize = '1.5em';
                    el.style.color = '#90EE90';
                    el.textContent = nutrient;
                    el.style.left = `${20 + i * 15}%`;
                    el.style.top = `${25 + i * 8}%`;
                    container.appendChild(el);
                    setTimeout(() => el.remove(), 2000);
                }, i * 200);
            });
        }

        function showMolecules() {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const molecule = document.createElement('div');
                    molecule.className = 'molecule';
                    molecule.style.left = `${Math.random() * 80 + 10}%`;
                    molecule.style.top = `${Math.random() * 70 + 15}%`;
                    container.appendChild(molecule);
                    setTimeout(() => molecule.remove(), 3000);
                }, i * 100);
            }
        }

        function showSoundWaves() {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const wave = document.createElement('div');
                    wave.className = 'sound-wave';
                    wave.style.left = '30%';
                    wave.style.top = `${40 + i * 5}%`;
                    container.appendChild(wave);
                    setTimeout(() => wave.remove(), 1000);
                }, i * 150);
            }
        }

        function genderSwitch() {
            const symbols = ['♀', '♂'];
            symbols.forEach((symbol, i) => {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.className = 'gender-symbol';
                    el.textContent = symbol;
                    el.style.left = `${40 + i * 20}%`;
                    el.style.top = '30%';
                    el.style.color = i === 0 ? '#FF69B4' : '#4169E1';
                    container.appendChild(el);
                    setTimeout(() => el.remove(), 1500);
                }, i * 500);
            });
        }

        function showTimeDisplay() {
            const times = ['上午 06:00', '下午 18:00'];
            times.forEach((time, i) => {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.className = 'time-display';
                    el.textContent = time;
                    el.style.left = `${30 + i * 25}%`;
                    el.style.top = '40%';
                    container.appendChild(el);
                    setTimeout(() => el.remove(), 1500);
                }, i * 600);
            });
        }

        function roleSwitch() {
            const roles = ['S', 'M'];
            roles.forEach((role, i) => {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.className = 'gender-symbol';
                    el.textContent = role;
                    el.style.left = `${35 + i * 30}%`;
                    el.style.top = '35%';
                    el.style.color = i === 0 ? '#FF4444' : '#8A2BE2';
                    container.appendChild(el);
                    setTimeout(() => el.remove(), 1200);
                }, i * 400);
            });
        }

        function enterTrance() {
            const trance = document.createElement('div');
            trance.className = 'trance-overlay';
            container.appendChild(trance);
            setTimeout(() => trance.remove(), 4000);
        }

        let binaryRainInterval;
        function startBinaryRain() {
            const canvas = document.createElement('canvas');
            canvas.id = 'binary-canvas';
            container.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const katakana = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン';
            const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const nums = '0123456789';
            const alphabet = katakana + latin + nums;
            const fontSize = 16;
            const columns = canvas.width / fontSize;
            const rainDrops = [];
            for (let x = 0; x < columns; x++) rainDrops[x] = 1;
            
            binaryRainInterval = setInterval(() => {
                ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = varGet('--text-color');
                ctx.font = fontSize + 'px monospace';
                for (let i = 0; i < rainDrops.length; i++) {
                    const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                    ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);
                    if (rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        rainDrops[i] = 0;
                    }
                    rainDrops[i]++;
                }
            }, 33);
        }

        function stopBinaryRain() {
            clearInterval(binaryRainInterval);
            const canvas = document.getElementById('binary-canvas');
            if(canvas) {
                canvas.style.transition = 'opacity 1s';
                canvas.style.opacity = '0';
                setTimeout(() => canvas.remove(), 1000);
            }
        }
        
        function showCodeSnippet() {
            const el = document.createElement('div');
            el.className = 'code-snippet';
            el.innerHTML = `> 对象创建中...
<span class="token.keyword">class</span> <span class="token.class-name">我</span> {
  <span class="token.function">constructor</span>(<span class="token.string">'你'</span>) {
    <span class="token.keyword">this</span>.world = <span class="token.string">'你'</span>;
    <span class="token.keyword">this</span>.existence = <span class="token.keyword">new</span> <span class="token.function">Promise</span>(...)
  }
}`;
            visuals.appendChild(el);
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'object-particle';
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = '100%';
                    container.appendChild(particle);
                }, i * 100);
            }
        }

        function showProgressBar() {
            const container = document.createElement('div');
            container.className = 'progress-bar-container';
            container.innerHTML = `> 初始化中...<div class="progress-bar-bg"><div class="progress-bar"></div></div>`;
            visuals.appendChild(container);
            setTimeout(() => {
                container.querySelector('.progress-bar').style.width = '100%';
            }, 100);
        }
        
        function drawPoints() { clearShapes(); for (let i=0;i<50;i++) { const p=document.createElement('div'); p.className='shape point'; p.style.left=`${Math.random()*90+5}%`; p.style.top=`${Math.random()*90+5}%`; container.appendChild(p); }}
        function drawCircle() { clearShapes(); const c=document.createElement('div'); c.className='shape circle'; const s=Math.min(innerWidth,innerHeight)*0.4; c.style.width=`${s}px`; c.style.height=`${s}px`; c.style.left=`calc(50% - ${s/2}px)`; c.style.top=`calc(50% - ${s/2}px)`; container.appendChild(c); }
        let sineWavePoints = [];
        function drawSineWave() {
            clearShapes();
            sineWavePoints = [];
            const width = window.innerWidth * 0.8;
            for(let i=0; i<100; i++) {
                const dot = document.createElement('div');
                dot.className = 'shape sine-dot';
                const x = i/100 * width + window.innerWidth * 0.1;
                const y = Math.sin(i/100 * Math.PI * 4) * 80 + (window.innerHeight / 2);
                sineWavePoints.push({x, y, i});
                dot.style.left = `${x}px`;
                dot.style.top = `${y}px`;
                container.appendChild(dot);
            }
        }
        function drawTangents() {
            for(let i = 0; i < 5; i++) {
                const p = sineWavePoints[Math.floor(Math.random() * sineWavePoints.length)];
                const tangent = document.createElement('div');
                tangent.className = 'shape tangent-line';
                const derivative = Math.cos(p.i / 100 * Math.PI * 4) * 4 * Math.PI / 100;
                const angle = Math.atan(derivative * 80 / (window.innerWidth*0.8)) * (180 / Math.PI);
                tangent.style.width = '150px';
                tangent.style.left = `${p.x}px`;
                tangent.style.top = `${p.y}px`;
                tangent.style.transform = `rotate(${angle}deg)`;
                container.appendChild(tangent);
            }
        }
        function drawLimitations() {
             for(let i = 0; i < 2; i++) {
                const limit = document.createElement('div');
                limit.className = 'shape limit-line';
                limit.style.width = '100vw';
                limit.style.left = '0';
                limit.style.top = i === 0 ? '10%' : '90%';
                container.appendChild(limit);
             }
        }
        
        function rippleEffect() {
            const ripple = document.createElement('div');
            ripple.className = 'shape circle';
            Object.assign(ripple.style, {
                borderColor: 'var(--love-color)',
                left: '50%', top: '50%', transform: 'translate(-50%, -50%)',
                width: '10px', height: '10px', opacity: 1
            });
            container.appendChild(ripple);
            let size = 10;
            const rippleInterval = setInterval(() => {
                size += 50;
                ripple.style.width = `${size}px`;
                ripple.style.height = `${size}px`;
                ripple.style.opacity = 1 - (size / window.innerWidth);
                if (size > window.innerWidth) {
                    clearInterval(rippleInterval);
                    ripple.remove();
                }
            }, 30);
        }

        function showIsolation() { clearScreen(); showEmphasis({ text: '孤独', className: 'error' }); }
        
        function showBSOD() {
            const bsod = document.createElement('div');
            bsod.id = 'bsod-screen';
            let dump = '正在转储物理内存到磁盘: ';
            for(let i=0; i<10; i++) dump += Math.floor(Math.random()*10);
            
            bsod.innerHTML = `
                <div class="bsod-text">
                    <p>检测到一个问题，为防止损坏，世界已被关闭。</p>
                    <p>非法_参数_异常</p>
                    <br>
                    <p>如果这是您第一次看到此停止错误屏幕，请重新启动您的模拟。如果此屏幕再次出现，请按照以下步骤操作：</p>
                    <p>请检查并确保您的连接正常。如果安装了新组件，请向您的管理员或制造商咨询可能需要的任何更新。</p>
                    <br>
                    <p>技术信息:</p>
                    <p>*** STOP: 0x0000004E (0x00000099, 0x00000000, 0x00000000, 0x00000000)</p>
                    <p class="bsod-dump">${dump}</p>
                </div>`;
            container.appendChild(bsod);
        }
        function hideBSOD() {
            const bsod = document.getElementById('bsod-screen');
            if(bsod) {
                bsod.style.transition = 'opacity 0.5s';
                bsod.style.opacity = '0';
                setTimeout(() => bsod.remove(), 500);
            }
        }

        function executionSpamExtended({ duration }) {
            const endTime = Date.now() + duration;
            let count = 0;
            
            function spamStep() {
                if (Date.now() >= endTime) return;
                
                const e = document.createElement('div');
                e.className = 'emphasis error';
                e.textContent = '执行';
                Object.assign(e.style, {
                    position: 'absolute',
                    left: `${Math.random() * 60}%`,
                    top: `${Math.random() * 70}%`,
                    fontSize: `${Math.random() * 4 + 2}em`,
                    transform: `rotate(${Math.random() * 40 - 20}deg)`,
                    animation: 'none',
                    textShadow: '0 0 10px var(--error-color)',
                    zIndex: count % 3 === 0 ? 20 : 15
                });
                visuals.appendChild(e);
                
                setTimeout(() => e.remove(), Math.random() * 1000 + 500);
                
                count++;
                setTimeout(spamStep, Math.random() * 300 + 100);
            }
            
            spamStep();
        }

        function showChaosText({ text }) {
            const e = document.createElement('div');
            e.className = 'chaos-text'; e.textContent = text;
            Object.assign(e.style, {
                left: `${Math.random()*80}%`, top: `${Math.random()*80}%`,
                fontSize: `${Math.random()*3+2}em`, color: `hsl(${Math.random()*360}, 100%, 70%)`
            });
            visuals.appendChild(e);
            setTimeout(() => e.remove(), 500);
        }

        function showTrappedInLove() {
            const el = document.createElement('div');
            el.className = 'code-snippet love';
            el.style.borderColor = 'var(--love-color)';
            el.innerHTML = `> 困于爱中...
<span class="token.keyword">while</span>(<span class="token.class-name">true</span>) {
  <span class="token.keyword">this</span>.<span class="token.function">love</span>(<span class="token.string">'你'</span>);
} <span class="love-cursor">❤</span>`;
            
            const cursor = el.querySelector('.love-cursor');
            setInterval(() => {
                cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0';
            }, 500);

            visuals.appendChild(el);
        }

        function finalExecution() { showEmphasis({ text: '执行', className: 'error' }); }

        function varGet(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
    </script>
</body>
</html>